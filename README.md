# Instantiating a hardened [module](https://en.wikipedia.org/wiki/Modular_programming) **A** twice in a [module](https://en.wikipedia.org/wiki/Modular_programming) **B**

Hardened modules allow predictable timing, efficient placement, and scalable
hierarchical ASIC design.

This tutorial demonstrates how to use [Silicon Compiler](https://docs.siliconcompiler.com/en/latest/index.html) to harden a [Verilog](https://en.wikipedia.org/wiki/Verilog) [module](https://en.wikipedia.org/wiki/Modular_programming) as a reusable macro, and then instantiate it multiple times in
another [module](https://en.wikipedia.org/wiki/Modular_programming) by:

1. Writing a simple [Verilog](https://en.wikipedia.org/wiki/Verilog) [module](https://en.wikipedia.org/wiki/Modular_programming) **A**

2. Synthesizing, placing, and routing **A** using [Silicon Compiler](https://docs.siliconcompiler.com/en/latest/index.html) 
3. Packaging the resulting layout and timing models from **A** as a hard macro

4. Instantiating the hard macro **A** twice inside a second [module](https://en.wikipedia.org/wiki/Modular_programming) **B**

5. Running the ASIC flow on [module](https://en.wikipedia.org/wiki/Modular_programming) **B**

All these steps are contained in the single [Python](https://www.python.org/) [script](https://en.wikipedia.org/wiki/Scripting_language) detailed below.

To  run this [script](https://en.wikipedia.org/wiki/Scripting_language): 
```
docker run --rm -v "$(pwd):/sc_work" ghcr.io/siliconcompiler/sc_runner:v0.35.3 python3 silicon_compiler_mod_A_in_mod_B.py
```

The output will appear in: ``./build/B/job0/write.gds/0/outputs/B.png``

## Environment Setup

Import the tools to be used:


## Parameters

These parameters determine the size of the design and the names of the
modules in the design.


## Files used

These files will contain the [Verilog](https://en.wikipedia.org/wiki/Verilog) generated by this [script](https://en.wikipedia.org/wiki/Scripting_language). 

## Step 1: Create Verilog for [module](https://en.wikipedia.org/wiki/Modular_programming) **A**

**A** is a simple ``AND`` gate with a registered output triggered by the [clock](https://en.wikipedia.org/wiki/Clock_generator). 

## Step 2: Synthesize, Place & Route [module](https://en.wikipedia.org/wiki/Modular_programming) **A**

The following [code](https://en.wikipedia.org/wiki/Computer_program) will build [module](https://en.wikipedia.org/wiki/Modular_programming) **A** with the [Silicon Compiler](https://docs.siliconcompiler.com/en/latest/index.html) default
``ASIC`` flow:


## Step 3: Create a Macro Library Class from **A**

Take the generated ``LEF``, ``GDS``, and ``Liberty`` files and package them into a
custom library class so **A** can be instantiated as a hard macro.

Define a class that inherits from the relevant tools and
provides them with the locations of the files generated by [Silicon Compiler](https://docs.siliconcompiler.com/en/latest/index.html) during the processing of [module](https://en.wikipedia.org/wiki/Modular_programming) **A**.


## Step 4: Create Verilog for a [module](https://en.wikipedia.org/wiki/Modular_programming) **B** that instantiates **A**

Module **B** instantiates **A** as a hard macro several times.


## Step 5: Build **B** with **A** as a Custom Library

Configure [Silicon Compiler](https://docs.siliconcompiler.com/en/latest/index.html) to treat ``modA`` as an available macro
in the ``ASIC`` flow for **B**.


Setting core and [die](http://perldoc.perl.org/functions/die.html) area correctly is crucial for successful macro placement.


## Conclusion

This tutorial demonstrates how to perform a basic modular hierarchical ``ASIC`` design flow in [Silicon Compiler](https://docs.siliconcompiler.com/en/latest/index.html) by:

- Hardening a leaf [module](https://en.wikipedia.org/wiki/Modular_programming) **A**
- Exporting the layout and timing views from **A** as a custom library ``modA``
- Instantiating ``modA`` in the parent [module](https://en.wikipedia.org/wiki/Modular_programming) **B**

This approach enables scalable chip design with reusable hardened blocks.

